console.log("Trello Extension Background Service Worker Running");chrome.runtime.onInstalled.addListener(()=>{console.log("Extension installed successfully")});const a="0ca2121cebf7d50c52d2e1db24453fe8",i=()=>new Promise((s,l)=>{const e=chrome.identity.getRedirectURL(),t=`https://trello.com/1/authorize?expiration=never&name=TrelloReactBooster&scope=read,write&response_type=token&key=${a}&return_url=${encodeURIComponent(e)}`;chrome.identity.launchWebAuthFlow({url:t,interactive:!0},n=>{if(chrome.runtime.lastError||!n){l(chrome.runtime.lastError);return}const r=new URL(n),c=new URLSearchParams(r.hash.substring(1)).get("token");c?chrome.storage.local.set({trello_token:c},()=>{s(c)}):l(new Error("No token found in response"))})});chrome.runtime.onMessage.addListener((s,l,e)=>{if(s.action==="authenticate")return i().then(t=>e({success:!0,token:t})).catch(t=>e({success:!1,error:t.message})),!0;if(s.action==="get-boards"){const{token:t}=s,n=`https://api.trello.com/1/members/me/boards?key=${a}&token=${t}&fields=name,url,prefs&filter=open`;return fetch(n).then(r=>r.json()).then(r=>e({success:!0,data:r})).catch(r=>e({success:!1,error:r.message})),!0}else if(s.action==="get-board-data"){const{token:t,boardId:n}=s,r=`https://api.trello.com/1/boards/${n}/lists?key=${a}&token=${t}&cards=open&card_fields=name,url,pos`;return fetch(r).then(o=>o.json()).then(o=>e({success:!0,data:o})).catch(o=>e({success:!1,error:o.message})),!0}else if(s.action==="create-card"){const{token:t,listId:n,name:r}=s,o=`https://api.trello.com/1/cards?key=${a}&token=${t}&idList=${n}&name=${encodeURIComponent(r)}`;return fetch(o,{method:"POST"}).then(c=>c.json()).then(c=>e({success:!0,data:c})).catch(c=>e({success:!1,error:c.message})),!0}else if(s.action==="delete-card"){const{token:t,cardId:n}=s,r=`https://api.trello.com/1/cards/${n}?key=${a}&token=${t}`;return fetch(r,{method:"DELETE"}).then(o=>{o.ok?e({success:!0}):e({success:!1,error:"Failed to delete"})}).catch(o=>e({success:!1,error:o.message})),!0}else if(s.action==="move-card"){const{token:t,cardId:n,listId:r}=s,o=`https://api.trello.com/1/cards/${n}?key=${a}&token=${t}&idList=${r}`;return fetch(o,{method:"PUT"}).then(c=>c.json()).then(c=>e({success:!0,data:c})).catch(c=>e({success:!1,error:c.message})),!0}});
