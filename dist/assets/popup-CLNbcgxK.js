(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();document.addEventListener("DOMContentLoaded",()=>{console.log("Popup: Minimal script loaded and DOMContentLoaded fired!");const a=document.getElementById("apiKeySection"),s=document.getElementById("trelloBoardsContainer"),i=document.getElementById("apiKeyInput"),c=document.getElementById("saveKeyBtn"),e=document.getElementById("status"),t=document.getElementById("boardsList"),o=(r,n=!1)=>{e&&(e.textContent=r,e.style.color=n?"red":"green")},d=()=>{a&&(a.style.display="block"),s&&(s.style.display="none")},m=()=>{a&&(a.style.display="none"),s&&(s.style.display="block")},f=async()=>{o("Authenticating with Trello...",!1);try{const r=await chrome.runtime.sendMessage({action:"authenticate"});if(!r||!r.success){o(`Authentication failed: ${r.error||"Unknown error"}`,!0),d();return}const n=r.token;o("Fetching Trello boards...",!1);const l=await chrome.runtime.sendMessage({action:"get-boards",token:n});l&&l.success&&l.data?(m(),t&&(t.innerHTML="",l.data.forEach(p=>{const y=document.createElement("li"),u=document.createElement("a");u.href=p.url,u.textContent=p.name,u.target="_blank",y.appendChild(u),t.appendChild(y)}),o(`Loaded ${l.data.length} Trello boards.`,!1))):(o(`Error fetching boards: ${l.error||"Unknown error"}`,!0),d())}catch(r){o(`Communication error during board fetch: ${r.message}`,!0),console.error("Popup: Error during board fetch:",r),d()}};chrome.storage.local.get(["trello_api_key"],async r=>{if(!i||!c||!e||!s||!t||!a){console.error("Popup: One or more required DOM elements not found!"),a&&(a.style.display="block");return}r.trello_api_key?(i.value=r.trello_api_key,o("API Key found. Attempting to load boards...",!1),await f()):(d(),o("Please enter your Trello API Key.",!1))}),c&&i&&c.addEventListener("click",async()=>{const r=i.value.trim();if(!r){o("API Key cannot be empty!",!0);return}o("Saving API Key and authenticating...",!1),console.log("Popup: Sending save-api-key message to background.");try{const n=await chrome.runtime.sendMessage({action:"save-api-key",key:r});n&&n.success?(console.log("Popup: API Key saved successfully. Now fetching boards."),await f()):(o(`Error saving API Key: ${n.error||"Unknown error"}`,!0),console.error("Popup: Error saving API Key:",n.error))}catch(n){o(`Communication error: ${n.message}`,!0),console.error("Popup: Error sending message to background:",n)}})});
