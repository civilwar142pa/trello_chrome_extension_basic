console.log("Trello Extension Background Service Worker Running");chrome.runtime.onInstalled.addListener(()=>{console.log("Extension installed successfully")});const s=()=>new Promise((o,a)=>{chrome.storage.local.get(["trello_api_key"],r=>{r.trello_api_key?o(r.trello_api_key):a(new Error("Trello API Key not configured. Please set it in the extension settings."))})}),u=()=>s().then(o=>new Promise((a,r)=>{const n=chrome.identity.getRedirectURL(),c=`https://trello.com/1/authorize?expiration=never&name=TrelloReactBooster&scope=read,write&response_type=token&key=${o}&return_url=${encodeURIComponent(n)}`;chrome.identity.launchWebAuthFlow({url:c,interactive:!0},e=>{if(chrome.runtime.lastError||!e){r(chrome.runtime.lastError);return}const t=new URL(e),i=new URLSearchParams(t.hash.substring(1)).get("token");i?chrome.storage.local.set({trello_token:i},()=>{a(i)}):r(new Error("No token found in response"))})}));chrome.runtime.onMessage.addListener((o,a,r)=>{if(o.action==="save-api-key")return chrome.storage.local.set({trello_api_key:o.key},()=>{r({success:!0})}),!0;if(o.action==="authenticate")return u().then(n=>r({success:!0,token:n})).catch(n=>r({success:!1,error:n.message})),!0;if(o.action==="get-boards"){const{token:n}=o;return s().then(c=>{const e=`https://api.trello.com/1/members/me/boards?key=${c}&token=${n}&fields=name,url,prefs&filter=open`;return fetch(e)}).then(c=>c.json()).then(c=>r({success:!0,data:c})).catch(c=>r({success:!1,error:c.message})),!0}else if(o.action==="get-board-data"){const{token:n,boardId:c}=o;return s().then(e=>{const t=`https://api.trello.com/1/boards/${c}/lists?key=${e}&token=${n}&cards=open&card_fields=name,url,pos`;return fetch(t)}).then(e=>e.json()).then(e=>r({success:!0,data:e})).catch(e=>r({success:!1,error:e.message})),!0}else if(o.action==="create-card"){const{token:n,listId:c,name:e}=o;return s().then(t=>{const l=`https://api.trello.com/1/cards?key=${t}&token=${n}&idList=${c}&name=${encodeURIComponent(e)}`;return fetch(l,{method:"POST"})}).then(t=>t.json()).then(t=>r({success:!0,data:t})).catch(t=>r({success:!1,error:t.message})),!0}else if(o.action==="delete-card"){const{token:n,cardId:c}=o;return s().then(e=>{const t=`https://api.trello.com/1/cards/${c}?key=${e}&token=${n}`;return fetch(t,{method:"DELETE"})}).then(e=>{e.ok?r({success:!0}):r({success:!1,error:"Failed to delete"})}).catch(e=>r({success:!1,error:e.message})),!0}else if(o.action==="move-card"){const{token:n,cardId:c,listId:e}=o;return s().then(t=>{const l=`https://api.trello.com/1/cards/${c}?key=${t}&token=${n}&idList=${e}`;return fetch(l,{method:"PUT"})}).then(t=>t.json()).then(t=>r({success:!0,data:t})).catch(t=>r({success:!1,error:t.message})),!0}});
